<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Glow On · 產品詳情</title>
  <link rel="stylesheet" href="styles.css"/>
  <style>
    .container{max-width:1100px;margin:0 auto;padding:16px}
    .wrap{display:flex;gap:20px;flex-wrap:wrap}
    .preview{flex:1 1 440px}
    .preview img{width:100%;aspect-ratio:1/1;object-fit:contain;background:#fff;border:1px solid #e5e7eb;border-radius:10px}
    .meta{flex:1 1 360px}
    h1{margin:0 0 10px;font-size:22px}
    .price{color:#e11d48;font-weight:800;margin:8px 0}
    .row{margin:12px 0}
    input[type=number]{width:96px;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px}
    .btn{padding:10px 14px;border:1px solid #e5e7eb;border-radius:10px;cursor:pointer}
    .btn.primary{background:#111;color:#fff;border-color:#111}
    .desc{margin-top:20px;border-top:1px dashed #e5e7eb;padding-top:12px;line-height:1.8}
    /* 购物车徽标（若全站已有样式，可忽略） */
    .badge{display:inline-flex;min-width:18px;height:18px;padding:0 6px;align-items:center;justify-content:center;background:#111;color:#fff;border-radius:999px;font-size:12px;margin-left:4px}
  </style>
</head>
<body data-page="product">
  <!-- Header -->
  <header class="site-header">
    <div class="container">
      <nav class="top">
        <div class="left">
          <a href="index.html" class="logo">
            <img src="Archive/logo.png" alt="Glow On logo">
            <strong data-i18n="brand">Glow On</strong>
          </a>
          <div class="nav">
            <a href="index.html" data-i18n="nav_home">首頁</a>
            <a href="preorder.html" data-route="preorder" data-i18n="nav_preorder">精選預購</a>
            <a href="instock.html"  data-route="instock"  data-i18n="nav_instock">現貨專區</a>
            <a href="buyagent.html" data-route="service"  data-i18n="nav_service">澳洲代購服務</a>
          </div>
        </div>

        <div class="actions">
          <a class="btn icon whatsapp" 
             href="https://wa.me/85297436663" 
             target="_blank" rel="noopener" title="WhatsApp" aria-label="WhatsApp">
            <img src="Archive/whats.png" alt="WhatsApp" style="height:24px;width:24px;">
          </a>
          <a class="btn icon search" href="#" title="Search" aria-label="Search">🔍</a>
          <a class="btn icon login"  href="login.html" title="Login" aria-label="Login">👤</a>
          <a class="btn icon cart"   href="checkout.html" title="Cart" aria-label="Cart">🛒 <span id="cartBadge" class="badge">0</span></a>

          <div class="lang">
            <button id="langBtn" class="lang-btn" type="button" aria-haspopup="menu" aria-expanded="false">
              <span aria-hidden="true">🌐</span>
              <span id="langLabel">繁體中文</span>
              <span class="caret" aria-hidden="true">▾</span>
            </button>
            <div class="lang-menu" id="langMenu" role="menu" hidden>
              <button role="menuitem" data-lc="zh-HK">繁體中文</button>
              <button role="menuitem" data-lc="en">English</button>
            </div>
          </div>

          <button class="btn icon" id="moreBtn" aria-haspopup="menu" aria-expanded="false" title="更多">⋯</button>
          <div class="more-menu" id="moreMenu" hidden>
            <a class="item" href="https://wa.me/85297436663" target="_blank" rel="noopener">
              <img src="Archive/whats.png" alt="WhatsApp" style="height:18px;width:18px;vertical-align:middle;"> WhatsApp
            </a>
            <a class="item" href="#" id="moreSearch">🔍 Search</a>
            <a class="item" href="login.html">👤 Login</a>
            <a class="item" href="checkout.html">🛒 Cart</a>
            <div class="sep"></div>
            <button class="item" type="button" data-set-lc="zh-HK">繁體中文</button>
            <button class="item" type="button" data-set-lc="en">English</button>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <main class="container" id="product">
    <div class="wrap">
      <div class="preview">
        <img id="p-img" alt="產品圖片">
      </div>
      <div class="meta">
        <h1 id="p-title">—</h1>
        <div class="price" id="p-price">HK$ —</div>

        <div class="row">
          數量：
          <input id="p-qty" type="number" min="1" value="1">
        </div>
        <div class="row">
          <button class="btn primary" id="btnAddCart">加入購物車</button>
          <a class="btn" href="checkout.html">查看購物車</a>
        </div>
      </div>
    </div>

    <section class="desc">
      <h3 data-i18n="details_title">商品詳情</h3>
      <div id="p-desc"></div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-box">
      <nav class="foot-row zh">
        <a href="terms.html"><b>條款及細則</b></a>
        <a href="privacy.html"><b>私隱政策</b></a>
        <a href="returns.html"><b>退換貨政策</b></a>
        <a href="process.html"><b>購買流程</b></a>
        <a href="payment.html"><b>付款方式</b></a>
        <a href="contact.html"><b>聯絡我們</b></a>
      </nav>
      <nav class="foot-row en">
        <a href="terms.html"><b>Terms &amp; Conditions</b></a>
        <a href="privacy.html"><b>Privacy Policy</b></a>
        <a href="returns.html"><b>Return &amp; Exchange Policy</b></a>
        <a href="process.html"><b>Shopping Process</b></a>
        <a href="payment.html"><b>Payment Methods</b></a>
        <a href="contact.html"><b>Contact Us</b></a>
      </nav>
      <div class="copy">2025 © Glow On HK. <span data-i18n="rights">All Rights Reserved.</span></div>
    </div>
  </footer>

  <script src="site.js"></script>
  <script>
    // 购物车工具
    const CART_KEY='glowon-cart';
    const getCart=()=>{ try{ return JSON.parse(localStorage.getItem(CART_KEY))||[] }catch{ return [] } };
    const setCart=(c)=> localStorage.setItem(CART_KEY, JSON.stringify(c));
    function updateBadge(){
      const badge=document.getElementById('cartBadge');
      if(!badge) return;
      const total = getCart().reduce((s,x)=>s+Number(x.qty||0),0);
      badge.textContent = total;
    }

    // 先渲染产品详情（来自 site.js -> products.json）
    document.addEventListener('DOMContentLoaded', async () => {
      await renderProductPage(); // 填充 #p-img/#p-title/#p-price/#p-desc
      updateBadge();

      // 从 URL 获取 pid，拿到完整对象用于加入购物车
      const url = new URL(location.href);
      const pid = url.searchParams.get('pid');
      const list = await loadProducts();
      const p = list.find(x => String(x.id) === String(pid));
      if (!p) return;

      document.getElementById('btnAddCart').addEventListener('click', ()=>{
        const qty = Math.max(1, parseInt(document.getElementById('p-qty').value||'1',10));
        const cart = getCart();

        // 如果购物车里已有该商品，则叠加数量
        const found = cart.find(x=> String(x.id)===String(p.id));
        if(found){ found.qty += qty; }
        else{
          cart.push({
            id: p.id,
            title: (getLocale()==='en' ? (p.title_en || p.title_zh) : (p.title_zh || p.title_en)),
            price: p.price_text,   // 例如 "HK$430"
            img: p.img,
            qty
          });
        }
        setCart(cart);
        updateBadge();
        alert('已加入購物車');
      });
    });
  </script>
</body>
</html>