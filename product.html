<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Glow On · 產品詳情</title>
  <link rel="stylesheet" href="styles.css"/>
  <style>
    .container{max-width:1100px;margin:0 auto;padding:16px}
    .wrap{display:flex;gap:20px;flex-wrap:wrap}
    .preview{flex:1 1 440px}
    .preview img{width:100%;aspect-ratio:1/1;object-fit:contain;background:#fff;border:1px solid #e5e7eb;border-radius:10px}
    .meta{flex:1 1 360px}
    h1{margin:0 0 10px;font-size:22px}
    .price{color:#e11d48;font-weight:800;margin:8px 0}
    .row{margin:12px 0}
    input[type=number]{width:96px;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px}
    .btn{padding:10px 14px;border:1px solid #e5e7eb;border-radius:10px;cursor:pointer}
    .btn.primary{background:#111;color:#fff;border-color:#111}
    .desc{margin-top:20px;border-top:1px dashed #e5e7eb;padding-top:12px;line-height:1.8}
    .desc h3{margin:0 0 10px}
    /* 商品详情图容器（预留多图展示） */
    .desc-images{margin-top:12px;display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .desc-images figure{margin:0}
    .desc-images img{width:100%;aspect-ratio:1/1;object-fit:cover;border:1px solid #e5e7eb;border-radius:10px;background:#fff}
    @media (max-width:920px){ .desc-images{ grid-template-columns:repeat(2,1fr); } }
    @media (max-width:520px){ .desc-images{ grid-template-columns:1fr; } }

    /* 购物车徽标 */
    .badge{display:inline-flex;min-width:18px;height:18px;padding:0 6px;align-items:center;justify-content:center;background:#111;color:#fff;border-radius:999px;font-size:12px;margin-left:4px}
  </style>
</head>
<body data-page="product">
  <!-- Header（与 process.html 一致） -->
  <header class="site-header">
    <div class="container">
      <nav class="top">
        <!-- 左：LOGO + 导航 -->
        <div class="left">
          <a href="index.html" class="logo">
            <img src="Archive/logo.png" alt="Glow On logo">
            <strong data-i18n="brand">Glow On</strong>
          </a>
          <div class="nav">
            <a href="index.html" data-i18n="nav_home">首頁</a>
            <a href="preorder.html" data-route="preorder" data-i18n="nav_preorder">精選預購</a>
            <a href="instock.html"  data-route="instock"  data-i18n="nav_instock">現貨專區</a>
            <a href="buyagent.html" data-route="service"  data-i18n="nav_service">澳洲代購服務</a>
          </div>
        </div>

        <!-- 右：动作 + 语言 -->
        <div class="actions">
          <a class="btn icon whatsapp"
             href="https://wa.me/85297436663"
             target="_blank" rel="noopener"
             title="WhatsApp" aria-label="WhatsApp">
            <img src="Archive/whats.png" alt="WhatsApp" style="height:24px;width:24px;">
          </a>
          <!-- 搜索预留入口 -->
          <a class="btn icon search" href="search.html" title="Search" aria-label="Search">🔍</a>
          <!-- 移除登录 -->
          <a class="btn icon cart" href="checkout.html" title="Cart" aria-label="Cart">
            🛒 <span id="cartBadge" class="badge">0</span>
          </a>

          <!-- 语言切换 -->
          <div class="lang">
            <button id="langBtn" class="lang-btn" type="button" aria-haspopup="menu" aria-expanded="false">
              <span aria-hidden="true">🌐</span>
              <span id="langLabel">繁體中文</span>
              <span class="caret" aria-hidden="true">▾</span>
            </button>
            <div class="lang-menu" id="langMenu" role="menu" hidden>
              <button role="menuitem" data-lc="zh-HK">繁體中文</button>
              <button role="menuitem" data-lc="en">English</button>
            </div>
          </div>

          <!-- 更多（手机端） -->
          <button class="btn icon" id="moreBtn" aria-haspopup="menu" aria-expanded="false" title="更多">⋯</button>
          <div class="more-menu" id="moreMenu" hidden>
            <a class="item" href="https://wa.me/85297436663" target="_blank" rel="noopener">
              <img src="Archive/whats.png" alt="WhatsApp" style="height:18px;width:18px;vertical-align:middle;"> WhatsApp
            </a>
            <a class="item" href="search.html" id="moreSearch">🔍 Search</a>
            <a class="item" href="checkout.html">🛒 Cart</a>
            <div class="sep"></div>
            <button class="item" type="button" data-set-lc="zh-HK">繁體中文</button>
            <button class="item" type="button" data-set-lc="en">English</button>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <main class="container" id="product">
    <div class="wrap">
      <div class="preview">
        <img id="p-img" alt="產品圖片">
      </div>
      <div class="meta">
        <h1 id="p-title">—</h1>
        <div class="price" id="p-price">HK$ —</div>

        <div class="row">
          數量：
          <input id="p-qty" type="number" min="1" value="1">
        </div>
        <div class="row">
          <button class="btn primary" id="btnAddCart">加入購物車</button>
          <a class="btn" href="checkout.html">查看購物車</a>
        </div>
      </div>
    </div>

    <section class="desc">
      <h3 data-i18n="details_title">商品詳情</h3>
      <div id="p-desc"></div>
      <!-- 详情图片栅格（与 CMS 对应 desc_images 数组） -->
      <div id="p-desc-images" class="desc-images"></div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-box">
      <nav class="foot-row zh">
        <a href="terms.html"><b>條款及細則</b></a>
        <a href="privacy.html"><b>私隱政策</b></a>
        <a href="returns.html"><b>退換貨政策</b></a>
        <a href="process.html"><b>購買流程</b></a>
        <a href="payment.html"><b>付款方式</b></a>
        <a href="contact.html"><b>聯絡我們</b></a>
      </nav>
      <nav class="foot-row en">
        <a href="terms.html"><b>Terms &amp; Conditions</b></a>
        <a href="privacy.html"><b>Privacy Policy</b></a>
        <a href="returns.html"><b>Return &amp; Exchange Policy</b></a>
        <a href="process.html"><b>Shopping Process</b></a>
        <a href="payment.html"><b>Payment Methods</b></a>
        <a href="contact.html"><b>Contact Us</b></a>
      </nav>
      <div class="copy">2025 © Glow On HK. <span data-i18n="rights">All Rights Reserved.</span></div>
    </div>
  </footer>

  <script src="site.js"></script>
  <script>
    // 购物车工具
    const CART_KEY='glowon-cart';
    const getCart=()=>{ try{ return JSON.parse(localStorage.getItem(CART_KEY))||[] }catch{ return [] } };
    const setCart=(c)=> localStorage.setItem(CART_KEY, JSON.stringify(c));
    function updateBadge(){
      const badge=document.getElementById('cartBadge');
      if(!badge) return;
      badge.textContent = getCart().reduce((s,x)=>s+Number(x.qty||0),0);
    }

    function currentLocale(){
      try{ if (typeof getLocale === 'function'){ const lc=getLocale(); if(lc==='en'||lc==='zh-HK') return lc; } }catch(e){}
      return (document.documentElement.lang||'').toLowerCase().startsWith('en') ? 'en' : 'zh-HK';
    }

    function renderDetailImages(product){
      const box=document.getElementById('p-desc-images');
      box.innerHTML='';
      const imgs = product?.desc_images || product?.desc_imgs || [];
      imgs.forEach(src=>{
        const fig=document.createElement('figure');
        const img=document.createElement('img');
        img.src=src;
        img.alt=product?.title_zh||product?.title_en||'product image';
        fig.appendChild(img);
        box.appendChild(fig);
      });
    }

    document.addEventListener('DOMContentLoaded', async () => {
      // 渲染产品基本信息（site.js 提供）
      await renderProductPage();
      updateBadge();

      // “首頁/Homepage”文案兜底（与 process.html 一致）
      const lc = currentLocale();
      document.querySelectorAll('[data-i18n="nav_home"]').forEach(el=>{
        el.textContent = (lc === 'en' ? 'Homepage' : '首頁');
      });

      // 用 pid 找到完整商品对象，用于详情图和加入购物车
      const pid = new URL(location.href).searchParams.get('pid');
      const list = await loadProducts();
      const p = list.find(x => String(x.id) === String(pid));
      if (!p) return;

      renderDetailImages(p);

      document.getElementById('btnAddCart').addEventListener('click', ()=>{
        const qty = Math.max(1, parseInt(document.getElementById('p-qty').value||'1',10));
        const cart = getCart();
        const found = cart.find(x=> String(x.id)===String(p.id));
        const priceText = (typeof p.price_hkd === 'number') ? `HK$${p.price_hkd}` : (p.price_text || 'HK$—');
        const title = (lc==='en' ? (p.title_en || p.title_zh) : (p.title_zh || p.title_en));
        if(found){ found.qty += qty; }
        else{ cart.push({ id:p.id, title, price:priceText, img:p.img, qty }); }
        setCart(cart);
        updateBadge();
        alert(lc==='en' ? 'Added to cart' : '已加入購物車');
      });
    });

    window.addEventListener('locale-changed', ()=>{
      const lc = currentLocale();
      document.querySelectorAll('[data-i18n="nav_home"]').forEach(el=>{
        el.textContent = (lc === 'en' ? 'Homepage' : '首頁');
      });
    });
  </script>
</body>
</html>