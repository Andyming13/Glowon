<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Glow On Â· ç”¢å“è©³æƒ…</title>
  <link rel="stylesheet" href="styles.css"/>
  <style>
    .container{max-width:1100px;margin:0 auto;padding:16px}
    .wrap{display:flex;gap:20px;flex-wrap:wrap}
    .preview{flex:1 1 440px}
    .preview img{width:100%;aspect-ratio:1/1;object-fit:contain;background:#fff;border:1px solid #e5e7eb;border-radius:10px}
    .meta{flex:1 1 360px}
    h1{margin:0 0 10px;font-size:22px}
    .price{color:#e11d48;font-weight:800;margin:8px 0}
    .row{margin:12px 0}
    input[type=number]{width:96px;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px}
    .btn{padding:10px 14px;border:1px solid #e5e7eb;border-radius:10px;cursor:pointer}
    .btn.primary{background:#111;color:#fff;border-color:#111}
    .desc{margin-top:20px;border-top:1px dashed #e5e7eb;padding-top:12px;line-height:1.8}
    .desc h3{margin:0 0 10px}
    /* å•†å“è¯¦æƒ…å›¾å®¹å™¨ï¼ˆé¢„ç•™å¤šå›¾å±•ç¤ºï¼‰ */
    .desc-images{margin-top:12px;display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .desc-images figure{margin:0}
    .desc-images img{width:100%;aspect-ratio:1/1;object-fit:cover;border:1px solid #e5e7eb;border-radius:10px;background:#fff}
    @media (max-width:920px){ .desc-images{ grid-template-columns:repeat(2,1fr); } }
    @media (max-width:520px){ .desc-images{ grid-template-columns:1fr; } }

    /* è´­ç‰©è½¦å¾½æ ‡ */
    .badge{display:inline-flex;min-width:18px;height:18px;padding:0 6px;align-items:center;justify-content:center;background:#111;color:#fff;border-radius:999px;font-size:12px;margin-left:4px}
  </style>
</head>
<body data-page="product">
  <!-- Headerï¼ˆä¸ process.html ä¸€è‡´ï¼‰ -->
  <header class="site-header">
    <div class="container">
      <nav class="top">
        <!-- å·¦ï¼šLOGO + å¯¼èˆª -->
        <div class="left">
          <a href="index.html" class="logo">
            <img src="Archive/logo.png" alt="Glow On logo">
            <strong data-i18n="brand">Glow On</strong>
          </a>
          <div class="nav">
            <a href="index.html" data-i18n="nav_home">é¦–é </a>
            <a href="preorder.html" data-route="preorder" data-i18n="nav_preorder">ç²¾é¸é è³¼</a>
            <a href="instock.html"  data-route="instock"  data-i18n="nav_instock">ç¾è²¨å°ˆå€</a>
            <a href="buyagent.html" data-route="service"  data-i18n="nav_service">æ¾³æ´²ä»£è³¼æœå‹™</a>
          </div>
        </div>

        <!-- å³ï¼šåŠ¨ä½œ + è¯­è¨€ -->
        <div class="actions">
          <a class="btn icon whatsapp"
             href="https://wa.me/85297436663"
             target="_blank" rel="noopener"
             title="WhatsApp" aria-label="WhatsApp">
            <img src="Archive/whats.png" alt="WhatsApp" style="height:24px;width:24px;">
          </a>
          <!-- æœç´¢é¢„ç•™å…¥å£ -->
          <a class="btn icon search" href="search.html" title="Search" aria-label="Search">ğŸ”</a>
          <!-- ç§»é™¤ç™»å½• -->
          <a class="btn icon cart" href="checkout.html" title="Cart" aria-label="Cart">
            ğŸ›’ <span id="cartBadge" class="badge">0</span>
          </a>

          <!-- è¯­è¨€åˆ‡æ¢ -->
          <div class="lang">
            <button id="langBtn" class="lang-btn" type="button" aria-haspopup="menu" aria-expanded="false">
              <span aria-hidden="true">ğŸŒ</span>
              <span id="langLabel">ç¹é«”ä¸­æ–‡</span>
              <span class="caret" aria-hidden="true">â–¾</span>
            </button>
            <div class="lang-menu" id="langMenu" role="menu" hidden>
              <button role="menuitem" data-lc="zh-HK">ç¹é«”ä¸­æ–‡</button>
              <button role="menuitem" data-lc="en">English</button>
            </div>
          </div>

          <!-- æ›´å¤šï¼ˆæ‰‹æœºç«¯ï¼‰ -->
          <button class="btn icon" id="moreBtn" aria-haspopup="menu" aria-expanded="false" title="æ›´å¤š">â‹¯</button>
          <div class="more-menu" id="moreMenu" hidden>
            <a class="item" href="https://wa.me/85297436663" target="_blank" rel="noopener">
              <img src="Archive/whats.png" alt="WhatsApp" style="height:18px;width:18px;vertical-align:middle;"> WhatsApp
            </a>
            <a class="item" href="search.html" id="moreSearch">ğŸ” Search</a>
            <a class="item" href="checkout.html">ğŸ›’ Cart</a>
            <div class="sep"></div>
            <button class="item" type="button" data-set-lc="zh-HK">ç¹é«”ä¸­æ–‡</button>
            <button class="item" type="button" data-set-lc="en">English</button>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <main class="container" id="product">
    <div class="wrap">
      <div class="preview">
        <img id="p-img" alt="ç”¢å“åœ–ç‰‡">
      </div>
      <div class="meta">
        <h1 id="p-title">â€”</h1>
        <div class="price" id="p-price">HK$ â€”</div>

        <div class="row">
          æ•¸é‡ï¼š
          <input id="p-qty" type="number" min="1" value="1">
        </div>
        <div class="row">
          <button class="btn primary" id="btnAddCart">åŠ å…¥è³¼ç‰©è»Š</button>
          <a class="btn" href="checkout.html">æŸ¥çœ‹è³¼ç‰©è»Š</a>
        </div>
      </div>
    </div>

    <section class="desc">
      <h3 data-i18n="details_title">å•†å“è©³æƒ…</h3>
      <div id="p-desc"></div>
      <!-- è¯¦æƒ…å›¾ç‰‡æ …æ ¼ï¼ˆä¸ CMS å¯¹åº” desc_images æ•°ç»„ï¼‰ -->
      <div id="p-desc-images" class="desc-images"></div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-box">
      <nav class="foot-row zh">
        <a href="terms.html"><b>æ¢æ¬¾åŠç´°å‰‡</b></a>
        <a href="privacy.html"><b>ç§éš±æ”¿ç­–</b></a>
        <a href="returns.html"><b>é€€æ›è²¨æ”¿ç­–</b></a>
        <a href="process.html"><b>è³¼è²·æµç¨‹</b></a>
        <a href="payment.html"><b>ä»˜æ¬¾æ–¹å¼</b></a>
        <a href="contact.html"><b>è¯çµ¡æˆ‘å€‘</b></a>
      </nav>
      <nav class="foot-row en">
        <a href="terms.html"><b>Terms &amp; Conditions</b></a>
        <a href="privacy.html"><b>Privacy Policy</b></a>
        <a href="returns.html"><b>Return &amp; Exchange Policy</b></a>
        <a href="process.html"><b>Shopping Process</b></a>
        <a href="payment.html"><b>Payment Methods</b></a>
        <a href="contact.html"><b>Contact Us</b></a>
      </nav>
      <div class="copy">2025 Â© Glow On HK. <span data-i18n="rights">All Rights Reserved.</span></div>
    </div>
  </footer>

  <script src="site.js"></script>
  <script>
    // è´­ç‰©è½¦å·¥å…·
    const CART_KEY='glowon-cart';
    const getCart=()=>{ try{ return JSON.parse(localStorage.getItem(CART_KEY))||[] }catch{ return [] } };
    const setCart=(c)=> localStorage.setItem(CART_KEY, JSON.stringify(c));
    function updateBadge(){
      const badge=document.getElementById('cartBadge');
      if(!badge) return;
      badge.textContent = getCart().reduce((s,x)=>s+Number(x.qty||0),0);
    }

    function currentLocale(){
      try{ if (typeof getLocale === 'function'){ const lc=getLocale(); if(lc==='en'||lc==='zh-HK') return lc; } }catch(e){}
      return (document.documentElement.lang||'').toLowerCase().startsWith('en') ? 'en' : 'zh-HK';
    }

    function renderDetailImages(product){
      const box=document.getElementById('p-desc-images');
      box.innerHTML='';
      const imgs = product?.desc_images || product?.desc_imgs || [];
      imgs.forEach(src=>{
        const fig=document.createElement('figure');
        const img=document.createElement('img');
        img.src=src;
        img.alt=product?.title_zh||product?.title_en||'product image';
        fig.appendChild(img);
        box.appendChild(fig);
      });
    }

    document.addEventListener('DOMContentLoaded', async () => {
      // æ¸²æŸ“äº§å“åŸºæœ¬ä¿¡æ¯ï¼ˆsite.js æä¾›ï¼‰
      await renderProductPage();
      updateBadge();

      // â€œé¦–é /Homepageâ€æ–‡æ¡ˆå…œåº•ï¼ˆä¸ process.html ä¸€è‡´ï¼‰
      const lc = currentLocale();
      document.querySelectorAll('[data-i18n="nav_home"]').forEach(el=>{
        el.textContent = (lc === 'en' ? 'Homepage' : 'é¦–é ');
      });

      // ç”¨ pid æ‰¾åˆ°å®Œæ•´å•†å“å¯¹è±¡ï¼Œç”¨äºè¯¦æƒ…å›¾å’ŒåŠ å…¥è´­ç‰©è½¦
      const pid = new URL(location.href).searchParams.get('pid');
      const list = await loadProducts();
      const p = list.find(x => String(x.id) === String(pid));
      if (!p) return;

      renderDetailImages(p);

      document.getElementById('btnAddCart').addEventListener('click', ()=>{
        const qty = Math.max(1, parseInt(document.getElementById('p-qty').value||'1',10));
        const cart = getCart();
        const found = cart.find(x=> String(x.id)===String(p.id));
        const priceText = (typeof p.price_hkd === 'number') ? `HK$${p.price_hkd}` : (p.price_text || 'HK$â€”');
        const title = (lc==='en' ? (p.title_en || p.title_zh) : (p.title_zh || p.title_en));
        if(found){ found.qty += qty; }
        else{ cart.push({ id:p.id, title, price:priceText, img:p.img, qty }); }
        setCart(cart);
        updateBadge();
        alert(lc==='en' ? 'Added to cart' : 'å·²åŠ å…¥è³¼ç‰©è»Š');
      });
    });

    window.addEventListener('locale-changed', ()=>{
      const lc = currentLocale();
      document.querySelectorAll('[data-i18n="nav_home"]').forEach(el=>{
        el.textContent = (lc === 'en' ? 'Homepage' : 'é¦–é ');
      });
    });
  </script>
</body>
</html>